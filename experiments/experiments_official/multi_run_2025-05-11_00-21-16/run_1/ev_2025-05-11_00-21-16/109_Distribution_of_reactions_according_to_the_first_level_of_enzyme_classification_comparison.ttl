
# Natural Language Question
# =======================
Distribution of reactions according to the first level of enzyme classification

# Target Endpoint
# ===============
https://sparql.rhea-db.org/sparql

# Ground Truth Query
# =================

PREFIX rh:<http://rdf.rhea-db.org/>
PREFIX ec:<http://purl.uniprot.org/enzyme/>
PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>
PREFIX skos:<http://www.w3.org/2004/02/skos/core#>

SELECT
  ?ecClass
  (str(?ecName) as ?ecClassName)
  (count(?reaction) as ?reactionCount)
WHERE
{
  SERVICE <http://sparql.uniprot.org/sparql> {
    VALUES (?ecClass) { (ec:1.-.-.-)(ec:2.-.-.-)(ec:3.-.-.-)(ec:4.-.-.-)(ec:5.-.-.-) (ec:6.-.-.-) (ec:7.-.-.-) }
    ?ecNumber rdfs:subClassOf ?ecClass .
    ?ecClass skos:prefLabel ?ecName .
  }
  ?reaction rdfs:subClassOf rh:Reaction .
  ?reaction rh:ec ?ecNumber .
}
GROUP BY ?ecClass ?ecName


# Predicted Query
# ==============
# https://sparql.rhea-db.org/sparql
PREFIX rhea: <http://rdf.rhea-db.org/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX uniprot: <http://purl.uniprot.org/core/>

SELECT ?enzymeClass (COUNT(DISTINCT ?reaction) AS ?reactionCount)
WHERE {
  # Subquery to get Rhea reaction IDs and their associated UniProt enzyme class (EC) numbers
  {
    SELECT DISTINCT ?reaction ?ec
    WHERE {
      ?reaction rdf:type rhea:Reaction .
      ?reaction rhea:equation ?equation . # Not really used, but helps focus on reactions

      # Attempt to link to UniProt via a SERVICE call.
      SERVICE <https://sparql.uniprot.org/sparql> {
        ?protein a uniprot:Protein ;
                 uniprot:enzymeClassification ?ec . # Get EC number
        # Assuming some predicate links Rhea reactions to UniProt proteins.  This is the crucial link and may need adjustment.
        # The following is a placeholder and needs to be replaced with the correct predicate if it exists.
        # Example:  FILTER EXISTS { ?reaction rhea:relatedProtein ?protein . } # Replace rhea:relatedProtein with the actual predicate
        # Another possible link via reaction participants (reactants/products).  Again, needs the correct predicate.
        # Example: ?reaction rhea:hasParticipant ?participant .  ?participant rhea:relatedProtein ?protein .
        # Without a direct link, this becomes very difficult.  Assuming a link based on reaction name/equation content is unreliable.
        # A possible, but less reliable, approach is to look for proteins that catalyze reactions with similar reactants/products.
        # This would require more complex subqueries and string matching, which is beyond the scope of this example without more information.
        # Assuming a link based on reaction participants (reactants/products).  Again, needs the correct predicate.
        # Example: ?reaction rhea:hasParticipant ?participant .  ?participant rhea:relatedProtein ?protein .
        #FILTER EXISTS { ?reaction rhea:relatedProtein ?protein . }
      }
    }
  }

  # Extract the first level of the enzyme classification (first number)
  BIND(SUBSTR(STR(?ec), 1, 1) AS ?enzymeClass) # Extract first digit

}
GROUP BY ?enzymeClass
ORDER BY DESC(?reactionCount)
